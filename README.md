# üèóÔ∏è Control System ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –¥–µ—Ñ–µ–∫—Ç–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–±–æ—Ç

[![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Next.js](https://img.shields.io/badge/Next.js-000000?style=for-the-badge&logo=nextdotjs&logoColor=white)](https://nextjs.org/)
[![HeroUI](https://img.shields.io/badge/HeroUI-7C3AED?style=for-the-badge)](https://www.heroui.com/)
[![Tailwind](https://img.shields.io/badge/Tailwind-38B2AC?style=for-the-badge&logo=tailwindcss&logoColor=white)](https://tailwindcss.com/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-4169E1?style=for-the-badge&logo=postgresql&logoColor=white)](https://www.postgresql.org/)
[![Drizzle ORM](https://img.shields.io/badge/Drizzle%20ORM-0B7A75?style=for-the-badge)](https://orm.drizzle.team/)
[![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://www.docker.com/)
[![Windows](https://img.shields.io/badge/Windows-0078D6?style=for-the-badge&logo=windows&logoColor=white)](https://www.microsoft.com/windows)
[![VS Code](https://img.shields.io/badge/VS%20Code-007ACC?style=for-the-badge&logo=visualstudiocode&logoColor=white)](https://code.visualstudio.com/)
[![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=git&logoColor=white)](https://git-scm.com/)

<p align="center">
  <img src="./screenshot.png" alt="–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∏—Å—Ç–µ–º—ã" width="1200"/>
  <br/>
  <i>–°–ø–∏—Å–æ–∫ –¥–µ—Ñ–µ–∫—Ç–æ–≤, —Ñ–∏–ª—å—Ç—Ä—ã, –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–µ—Ñ–µ–∫—Ç–∞, —Ñ–∞–π–ª—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</i>
</p>

Control System ‚Äî –≤–µ–±‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Next.js –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –¥–µ—Ñ–µ–∫—Ç–æ–≤, –ø—Ä–æ–µ–∫—Ç–æ–≤, –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —ç—Ç–∞–ø–æ–≤ —Å RBAC, —Ñ–∞–π–ª–∞–º–∏, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç–æ–º –æ—Ç—á—ë—Ç–æ–≤. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã App Router + Route Handlers, PostgreSQL + Drizzle ORM –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤–ª–æ–∂–µ–Ω–∏–π.

---

## –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è –≤ UI

- **–î–µ—Ñ–µ–∫—Ç—ã**
  - –°–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (—Å—Ç–∞—Ç—É—Å, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –ø—Ä–æ–µ–∫—Ç/–æ–±—ä–µ–∫—Ç/—ç—Ç–∞–ø, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å), —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.
  - –ü–µ—Ä–µ—Ö–æ–¥ –≤ –∫–∞—Ä—Ç–æ—á–∫—É: –∫–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ `–û—Ç–∫—Ä—ã—Ç—å` –≤ —Ç–∞–±–ª–∏—Ü–µ.
  - –°–æ–∑–¥–∞–Ω–∏–µ: –∫–Ω–æ–ø–∫–∞ `–°–æ–∑–¥–∞—Ç—å –¥–µ—Ñ–µ–∫—Ç` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª–∫—É —Å –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ–µ–∫—Ç–∞/–æ–±—ä–µ–∫—Ç–∞/—ç—Ç–∞–ø–∞, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, –¥–µ–¥–ª–∞–π–Ω–∞ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.
- **–ö–∞—Ä—Ç–æ—á–∫–∞ –¥–µ—Ñ–µ–∫—Ç–∞**
  - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –¥–µ–¥–ª–∞–π–Ω, –∫–Ω–æ–ø–∫–∞ `–°–æ—Ö—Ä–∞–Ω–∏—Ç—å`.
  - –°—Ç–∞—Ç—É—Å—ã: –Ω–∞–±–æ—Ä –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ù–æ–≤–∞—è ‚Üí –í —Ä–∞–±–æ—Ç–µ ‚Üí –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ ‚Üí –ó–∞–∫—Ä—ã—Ç–∞/–û—Ç–º–µ–Ω–µ–Ω–∞) ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏.
  - –§–∞–π–ª—ã: –∫–Ω–æ–ø–∫–∞ `–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª` (—Å–∫—Ä—ã—Ç—ã–π input), –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∞–≤–∞—Ö.
  - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–º –∏ —Ä–æ–ª—è–º–∏ `admin/manager`.
  - –ò—Å—Ç–æ—Ä–∏—è: —Ç–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞ —Å –¥–∞—Ç–æ–π, –¥–µ–π—Å—Ç–≤–∏–µ–º, –∞–≤—Ç–æ—Ä–æ–º –∏ –¥–µ—Ç–∞–ª—è–º–∏.
- **–ü—Ä–æ–µ–∫—Ç—ã / –û–±—ä–µ–∫—Ç—ã / –≠—Ç–∞–ø—ã**
  - –°–ø–∏—Å–∫–∏ –∏ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è. –î–æ—Å—Ç—É–ø–Ω–æ —Ä–æ–ª—è–º `admin` –∏ `manager`.
- **–û—Ç—á—ë—Ç—ã**
  - –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ñ–µ–∫—Ç–æ–≤ –≤ CSV/XLSX (—Ä–æ–ª—è–º `admin`, `manager`, `observer`) —á–µ—Ä–µ–∑ API `GET /api/reports/defects/export` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
- **–ù–∞–≤–∏–≥–∞—Ü–∏—è (Topbar)**
  - –ü—É–Ω–∫—Ç—ã –º–µ–Ω—é –≤–∏–¥–Ω—ã –ø–æ —Ä–æ–ª—è–º: –î–µ—Ñ–µ–∫—Ç—ã ‚Äî –≤—Å–µ–º; –ü—Ä–æ–µ–∫—Ç—ã/–û–±—ä–µ–∫—Ç—ã/–≠—Ç–∞–ø—ã ‚Äî `admin/manager`; –û—Ç—á—ë—Ç—ã ‚Äî `admin/manager/observer`.
  - –°–ø—Ä–∞–≤–∞ –ø—Ä–æ—Ñ–∏–ª—å: –∏–º—è, –¥–æ–ª–∂–Ω–æ—Å—Ç—å (description —Ä–æ–ª–∏), –ü—Ä–æ—Ñ–∏–ª—å, –í—ã—Ö–æ–¥.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ —Å–ª–æ–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã:

- **App Router + Route Handlers** ‚Äî UI –∏ API –≤ –æ–¥–Ω–æ–º Next.js –ø—Ä–æ–µ–∫—Ç–µ.
- **RBAC** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ API –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å –ø—É–Ω–∫—Ç–æ–≤ –≤ –Ω–∞–≤–±–∞—Ä–µ.
- **Auth** ‚Äî JWT –≤ HTTP‚Äëonly cookie; middleware –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã.
- **DB** ‚Äî PostgreSQL + Drizzle ORM, –º–∏–≥—Ä–∞—Ü–∏–∏, —è–≤–Ω–∞—è —Å—Ö–µ–º–∞ (`db/schema.ts`).
- **Storage** ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤ (`UPLOAD_DIR`).

```mermaid
classDiagram
    class WebApp {
      +Next.js(App Router)
      +HeroUI UI
      +Topbar & Pages
    }
    class ApiHandlers {
      +/api/auth/*
      +/api/projects|objects|stages
      +/api/defects/*
      +/api/reports/*
    }
    class AuthRBAC {
      +JWT (cookies)
      +Middleware
      +allowRoles()
    }
    class Database {
      +PostgreSQL
      +Drizzle ORM
      +Migrations
    }
    class Storage {
      +UPLOAD_DIR
      +saveFile()
      +download
    }
    WebApp ..> ApiHandlers
    ApiHandlers ..> AuthRBAC
    ApiHandlers ..> Database
    ApiHandlers ..> Storage
```

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

```mermaid
erDiagram
  ROLES ||--o{ USERS : has
  USERS ||--o{ DEFECTS : creates
  USERS ||--o{ DEFECTS : assigned
  PROJECTS ||--o{ OBJECTS : contains
  OBJECTS ||--o{ STAGES : contains
  PROJECTS ||--o{ DEFECTS : contains
  OBJECTS ||--o{ DEFECTS : contains
  STAGES ||--o{ DEFECTS : optional
  DEFECTS ||--o{ COMMENTS : has
  USERS ||--o{ COMMENTS : writes
  DEFECTS ||--o{ FILES : has
  USERS ||--o{ FILES : uploads

  ROLES {
    int id PK
    text name
    text description
  }
  USERS {
    uuid id PK
    text email
    text full_name
    int role_id FK
    bool is_active
  }
  PROJECTS {
    int id PK
    text name
    text description
  }
  OBJECTS {
    int id PK
    int project_id FK
    text name
    text address
  }
  STAGES {
    int id PK
    int object_id FK
    text name
  }
  DEFECTS {
    int id PK
    text title
    text status
    text priority
    int project_id FK
    int object_id FK
    int stage_id FK
    uuid assignee_id FK
    uuid creator_id FK
    timestamptz due_date
    timestamptz closed_at
  }
  COMMENTS {
    int id PK
    int defect_id FK
    uuid author_id FK
    text content
  }
  FILES {
    int id PK
    int defect_id FK
    uuid uploader_id FK
    text filename
    text storage_key
    text mime_type
    int size_bytes
  }
```

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–µ—Ñ–µ–∫—Ç–∞

```mermaid
stateDiagram-v2
    [*] --> new: —Å–æ–∑–¥–∞—Ç—å
    new --> in_progress: –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
    new --> cancelled: –æ—Ç–º–µ–Ω–∏—Ç—å

    in_progress --> review: –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
    in_progress --> cancelled: –æ—Ç–º–µ–Ω–∏—Ç—å

    review --> closed: –∑–∞–∫—Ä—ã—Ç—å
    review --> in_progress: –≤–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É
    review --> cancelled: –æ—Ç–º–µ–Ω–∏—Ç—å

    closed --> [*]
    cancelled --> [*]
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏

- **Adapter** ‚Äî –∏–∑–æ–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ `lib/storage.ts` (–ø—É—Ç—å –∏–∑ `UPLOAD_DIR`, —Ñ—É–Ω–∫—Ü–∏–∏ `saveFile`, `getPath`).
- **Service Module** ‚Äî –µ–¥–∏–Ω—ã–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É: `lib/db.ts`, `lib/jwt.ts`, `lib/auth.ts`.
- **RBAC** ‚Äî `allowRoles(session, roles)` –Ω–∞ API; –≤ UI –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ —Ä–æ–ª–∏.
- **Auditable actions** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –ø–æ –¥–µ—Ñ–µ–∫—Ç–∞–º (–º–∞—Ä—à—Ä—É—Ç—ã `.../history` –¥–ª—è —á—Ç–µ–Ω–∏—è).

---

## –ó–∞–ø—É—Å–∫

### –í–∞—Ä–∏–∞–Ω—Ç A: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1) –°–æ–∑–¥–∞–π—Ç–µ `.env` –ø–æ –æ–±—Ä–∞–∑—Ü—É `.env.example` –∏ –∑–∞–¥–∞–π—Ç–µ –º–∏–Ω–∏–º—É–º `SESSION_SECRET`.
2) –°–æ–±–µ—Ä–∏—Ç–µ –∏ –ø–æ–¥–Ω–∏–º–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker compose up -d --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:${APP_PORT:-3000}  
–ë–∞–∑–∞: —Å–µ—Ä–≤–∏—Å `db` –≤–Ω—É—Ç—Ä–∏ Compose. `DATABASE_URL` –¥–ª—è `app` —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `POSTGRES_*`.

–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```bash
docker compose logs -f app
```

–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:

```bash
docker compose down
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ª–æ–∫–∞–ª—å–Ω–æ (Node.js 20+, PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

1) `.env` (–ø—Ä–∏–º–µ—Ä):

```env
DATABASE_URL=postgres://postgres:1234@localhost:5432/control_system
SESSION_SECRET=super-long-random-secret
JWT_EXPIRES=7d
COOKIE_NAME=token
UPLOAD_DIR=./uploads
```

2) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
npm ci
npm run db:migrate
```

3) –ó–∞–ø—É—Å–∫ –¥–µ–≤-—Å–µ—Ä–≤–µ—Ä–∞:

```bash
npm run dev
```

---

## –ü–µ—Ä–≤–∏—á–Ω—ã–π –≤—Ö–æ–¥ (seed —Ä–æ–ª–µ–π –∏ –∞–¥–º–∏–Ω–∞)

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –Ω–∞ `POST /api/auth/signin` (–µ—Å–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π) –±—ç–∫–µ–Ω–¥:
- —Å–æ–∑–¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–µ —Ä–æ–ª–∏: `admin`, `manager`, `engineer`, `observer`;
- —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–∞–¥–º–∏–Ω–∞ c `email`, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º –≤ —Ñ–æ—Ä–º–µ, –∏ –ø–∞—Ä–æ–ª–µ–º –∏–∑ —ç—Ç–æ–≥–æ –∂–µ –∑–∞–ø—Ä–æ—Å–∞;
- –≤—ã–¥–∞—ë—Ç JWT –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ HTTP-only cookie (`COOKIE_NAME`).

–¢–æ –µ—Å—Ç—å, —á—Ç–æ–±—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å –≤—Ö–æ–¥–∞ —Å –∂–µ–ª–∞–µ–º—ã–º `email` –∏ –ø–∞—Ä–æ–ª–µ–º ‚Äî –≤—ã —Å—Ç–∞–Ω–µ—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

---

## –ú–∞—Ç—Ä–∏—Ü–∞ —Ä–æ–ª–µ–π (RBAC)

| –†–∞–∑–¥–µ–ª/–æ–ø–µ—Ä–∞—Ü–∏—è                | admin | manager | engineer | observer |
|--------------------------------|:-----:|:-------:|:--------:|:--------:|
| –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ñ–µ–∫—Ç–æ–≤              |   ‚úì   |    ‚úì    |    ‚úì     |    ‚úì     |
| –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤ |   ‚úì   |    ‚úì    | –∞–≤—Ç–æ—Ä/–∏—Å–ø. |    ‚úó     |
| –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ—Ñ–µ–∫—Ç–∞          |   ‚úì   |    ‚úì    | –∞–≤—Ç–æ—Ä/–∏—Å–ø. |    ‚úó     |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (CRUD —Å–≤–æ–∏—Ö)       |   ‚úì   |    ‚úì    |    ‚úì     |    ‚úó     |
| –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–º–æ–¥–µ—Ä–∞—Ü–∏—è —á—É–∂–∏—Ö)  |   ‚úì   |    ‚úì    |    ‚úó     |    ‚úó     |
| –§–∞–π–ª—ã: –∑–∞–≥—Ä—É–∑–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ       |   ‚úì   |    ‚úì    | –∞–≤—Ç–æ—Ä/–∏—Å–ø. |    ‚úó     |
| –ü—Ä–æ–µ–∫—Ç—ã/–û–±—ä–µ–∫—Ç—ã/–≠—Ç–∞–ø—ã: —Å–æ–∑–¥–∞–Ω–∏–µ|   ‚úì   |    ‚úì    |    ‚úó     |    ‚úó     |
| –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤                |   ‚úì   |    ‚úì    |    ‚úó     |    ‚úì     |

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: ¬´–∞–≤—Ç–æ—Ä/–∏—Å–ø.¬ª –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∏–Ω–∂–µ–Ω–µ—Ä –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å –¥–µ—Ñ–µ–∫—Ç, –µ—Å–ª–∏ –æ–Ω –∞–≤—Ç–æ—Ä –∏–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Postman)

- **–§–∞–π–ª—ã**:
  - –ö–æ–ª–ª–µ–∫—Ü–∏—è: `test base/Control System API Tests.postman_collection.json`
  - –û–∫—Ä—É–∂–µ–Ω–∏–µ: `test base/Control System - Local.postman_environment.json`

- **–®–∞–≥–∏**:
  1) –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ Postman.
  2) –í—ã–±–µ—Ä–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ `Control System - Local` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `base_url` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:3000`).
  3) –í—ã–ø–æ–ª–Ω–∏—Ç–µ `0. Dev / Seed demo data` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏.
  4) –í—ã–ø–æ–ª–Ω–∏—Ç–µ `1. Auth ‚Üí 1.1 Sign in (admin)` ‚Äî –∫—É–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (HTTP-only cookie).
  5) –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤: `Reference`, `Defects`, `Comments & Files & History`, `Reports`.
  6) –î–ª—è `4.3 Upload file` –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –ª—é–±–æ–π —Ñ–∞–π–ª –≤ –ø–æ–ª–µ form-data `file`.

- **–£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–ø–æ—Å–ª–µ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—è)**:
  - admin: `admin@demo.local` / `demo1234`
  - manager: `manager@demo.local` / `demo1234`
  - engineer: `engineer@demo.local` / `demo1234`
  - observer: `observer@demo.local` / `demo1234`

- **–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**:
  - –ï—Å–ª–∏ Postman –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie, –≤–∫–ª—é—á–∏—Ç–µ Cookie Jar (Cookies ‚Äî ON) –¥–ª—è –¥–æ–º–µ–Ω–∞ `base_url`.
  - –í –ø—Ä–æ–¥-—Å–±–æ—Ä–∫–µ (`NODE_ENV=production`) —Å–∏–¥–µ—Ä —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω: –∑–∞–¥–∞–π—Ç–µ `SEED_TOKEN` –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤—ã–∑–æ–≤–∏—Ç–µ
    `POST {{base_url}}/api/dev/seed?token=–í–ê–®_–¢–û–ö–ï–ù` –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer –í–ê–®_–¢–û–ö–ï–ù`.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `SESSION_SECRET` ‚Äî —Å–µ–∫—Ä–µ—Ç –¥–ª—è JWT (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
- `JWT_EXPIRES` ‚Äî —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è JWT (`7d` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
- `COOKIE_NAME` ‚Äî –∏–º—è cookie (`token`).
- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–≤ Docker —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ `POSTGRES_*`).
- `UPLOAD_DIR` ‚Äî –ø—É—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ (–≤ Docker `/app/uploads`).
- `APP_PORT` ‚Äî –ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `3000`).
- `POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_PORT` ‚Äî –¥–ª—è Compose.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

- `POST /api/auth/signin` ‚Äî –≤—Ö–æ–¥; —Å–æ–∑–¥–∞—ë—Ç HTTP‚Äëonly cookie.
- `POST /api/auth/signout` ‚Äî –≤—ã—Ö–æ–¥ (–æ—á–∏—Å—Ç–∫–∞ cookie).
- `GET /api/auth/me` ‚Äî —Å–≤–µ–¥–µ–Ω–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –µ–≥–æ —Ä–æ–ª–∏/–¥–æ–ª–∂–Ω–æ—Å—Ç–∏.
- `GET|POST /api/projects`, `GET|POST /api/objects`, `GET|POST /api/stages` ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏.
- `GET|POST /api/defects` ‚Äî —Å–ø–∏—Å–æ–∫/—Å–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è).
- `GET|PATCH /api/defects/:id` ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞.
- `GET|POST /api/defects/:id/comments` ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏; `PATCH /api/comments/:id`, `DELETE /api/comments/:id`.
- `GET|POST /api/defects/:id/files` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞/—Å–ø–∏—Å–æ–∫; `GET /api/files/:id/download`, `DELETE /api/files/:id`.
- `GET /api/defects/:id/history` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.
- `GET /api/reports/defects/export?format=csv|xlsx&...` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤.

---

## Roadmap

- –†–∞—Å—à–∏—Ä–∏—Ç—å –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–∞–≤ –ø–æ —Ä–æ–ª—è–º (UI+API).
- Rate limiting, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –î–∞—à–±–æ—Ä–¥—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏ –≤ –æ—Ç—á—ë—Ç–∞—Ö.
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Å—Ç–∞—Ç—É—Å—ã/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã.
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

-----

## FAQ / –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

- –ö–∞–∫ –ø–æ–ø–∞—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –≤ –ø–µ—Ä–≤—ã–π —Ä–∞–∑?
  - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `POST /api/auth/signin` —Å –ª—é–±—ã–º email –∏ –ø–∞—Ä–æ–ª–µ–º ‚Äî –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–¥–º–∏–Ω —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
- –ü–æ—á–µ–º—É —è –Ω–µ –≤–∏–∂—É –∫–Ω–æ–ø–∫—É ¬´–°–æ–∑–¥–∞—Ç—å ‚Ä¶¬ª?
{{ ... }}
- –ü–æ—á–µ–º—É –ø—É–Ω–∫—Ç ¬´–û—Ç—á—ë—Ç—ã¬ª –Ω–µ –≤–∏–¥–µ–Ω?
  - –í–∏–¥–∏–º–æ—Å—Ç—å –≤ Navbar –ø–æ —Ä–æ–ª—è–º: `admin/manager/observer` ‚Äî –≤–∏–¥—è—Ç ¬´–û—Ç—á—ë—Ç—ã¬ª, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –Ω–µ—Ç.
- –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ñ–∞–π–ª—ã?
  - –ù–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `UPLOAD_DIR` (`/app/uploads` –≤ Docker). –í –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –ø—É—Ç—å (storageKey).
- –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∂–∏–∑–Ω–∏ JWT?
  - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `JWT_EXPIRES` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `7d`). –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å.
- –ù—É–∂–µ–Ω –ª–∏ `DATABASE_URL` –≤ Docker?
  - –ù–µ—Ç, compose —Å–æ–±–∏—Ä–∞–µ—Ç –µ–≥–æ –∏–∑ `POSTGRES_*`. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ Docker `DATABASE_URL` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.

---
